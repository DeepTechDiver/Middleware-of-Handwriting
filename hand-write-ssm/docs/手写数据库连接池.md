# 《Java手写系列》-手写数据库连接池

 ## 1.目标

为了理解数据库连接池的底层原理，我们可以自己手写一个类似Hikar、Druid一样的高性能的数据库连接池!

## 2.数据库连接池原理

### 2.1.基本原理

在内部对象池中，维护一定数量的数据库连接，并对外暴露数据库连接的获取和返回方法。

如外部使用者可通过getConnection方法获取数据库连接，使用完毕后再通过releaseConnection方法将连接返回，注意此时的连接并没有关闭，而是由连接池管理器回收，并为下一次使用做好准备。

![《Java手写系列》-纯手写数据库连接池_java](https://s2.51cto.com/images/blog/202206/30095751_62bd031fbac9e76575.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=/format,webp/resize,m_fixed,w_1184)

### 2.2.连接池作用

①资源重用
由于数据库连接得到重用，避免了频繁创建、释放连接引起的大量性能开销。在减少系统消耗的基础上，增进了系统环境的平稳性（减少内存碎片以级数据库临时进程、线程的数量）

②更快的系统响应速度
数据库连接池在初始化过程中，往往已经创建了若干数据库连接置于池内备用。此时连接池的初始化操作均已完成。对于业务请求处理而言，直接利用现有可用连接，避免了数据库连接初始化和释放过程的时间开销，从而缩减了系统整体响应时间。

③新的资源分配手段
对于多应用共享同一数据库的系统而言，可在应用层通过数据库连接的配置，实现数据库连接技术。

④统一的连接管理，避免数据库连接泄露
在较为完备的数据库连接池实现中，可根据预先的连接占用超时设定，强制收回被占用的连接，从而避免了常规数据库连接操作中可能出现的资源泄露

## 3.纯手写数据库连接池

### 3.1.读取外部配置信息

**db.properties**

```
#文件名：db.properties 存储数据库配置相关信息
#数据库连接信息
jdbc.driver=com.mysql.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/basic
jdbc.username=root
jdbc.password=123456
# 初始化连接数
jdbc.initSize=3
# 最大连接数
jdbc.maxSize=6
# 是否启动检查
jdbc.health=true
# 检查延迟时间
jdbc.delay=2000
# 间隔时间，重复获得连接的频率（健康检查间隔时间）
jdbc.period=2000
# 连接超时时间，10S
jdbc.timeout=100000

# 重复获得连接的频率、毫秒
jdbc.waitime=1000
```





单例模式